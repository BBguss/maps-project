-- Create the table for storing user locations and logs
create table public.user_locations (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  latitude float8 not null,
  longitude float8 not null,
  device_id text not null,
  ip_address text,
  image_data text, -- Stores Base64 string of the image
  device_info jsonb -- Stores detailed JSON object of device specs
);

-- Set up Row Level Security (RLS)
-- For this demo, we allow anonymous inserts so the tracker works without login.
-- In production, you might want to restrict 'select' to authenticated admins only.
alter table public.user_locations enable row level security;

create policy "Allow public insert"
on public.user_locations
for insert
to public
with check (true);

create policy "Allow public read"
on public.user_locations
for select
to public
using (true);

-- Enable Realtime for this table
-- This allows the Admin Dashboard to receive live updates
alter publication supabase_realtime add table public.user_locations;